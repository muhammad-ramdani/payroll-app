import{K as Y,r,j as t,L as I}from"./app-yxEi3xJe.js";import{u as N,f as D,g as y}from"./index-CgUmL9e7.js";import{B as A}from"./badge-D-KVUJFH.js";import{S as M,a as T,b as k,c as R,d as v}from"./select-BnEmntSq.js";import{T as E,a as P,b as w,c as B,d as F,e as C}from"./table-DtoZaXGU.js";import{A as L}from"./app-layout-BmWLcPuv.js";import"./app-logo-icon-CXNx6eOd.js";import"./index-BcpDV_59.js";const _={not_started:["Belum Hadir","text-amber-500 bg-amber-500/10"],working:["Sedang Bekerja","text-emerald-500 bg-emerald-500/10"],finished:["Sudah Pulang","text-blue-500 bg-blue-500/10"],leave:["Libur Cuti","text-rose-500 bg-rose-500/10"],sick:["Libur Sakit","text-fuchsia-500 bg-fuchsia-500/10"]},H=n=>new Intl.DateTimeFormat("id-ID",{weekday:"long",day:"numeric"}).format(n),q=(n,l,m=Date.now())=>{if(!n)return"-";const g=f=>{const[b,x,e]=f.split(":").map(Number),a=new Date(m);return a.setHours(b,x,e),a},S=g(n),h=(l?g(l):new Date(m)).getTime()-S.getTime(),i=f=>String(f).padStart(2,"0"),p=Math.floor(h/36e5),d=Math.floor(h%36e5/6e4),u=Math.floor(h%6e4/1e3);return`${i(p)}:${i(d)}:${i(u)}`},V=({status:n})=>{const[l,m]=_[n];return t.jsx(A,{className:m,children:l})};function U(){const{props:{attendances:n}}=Y(),[l,m]=r.useState(n),[g,S]=r.useState(Date.now());r.useEffect(()=>{const e=setInterval(()=>S(Date.now()),1e3);return()=>clearInterval(e)},[]),r.useEffect(()=>{m(n)},[n]);const[o,h]=r.useState(()=>{const e=new Date().getFullYear(),a=n.map(c=>new Date(c.date).getFullYear()),s=[...new Set(a)].sort((c,j)=>c-j);return s.includes(e)?e:s[0]??e}),[i,p]=r.useState(()=>{const e=new Date().getMonth(),a=n.filter(c=>new Date(c.date).getFullYear()===o).map(c=>new Date(c.date).getMonth()),s=[...new Set(a)].sort((c,j)=>c-j);return s.includes(e)?e:s[0]??e}),d=r.useMemo(()=>{const e=new Set;return l.forEach(a=>{e.add(new Date(a.date).getFullYear())}),Array.from(e).sort((a,s)=>a-s)},[l]),u=r.useMemo(()=>{const e=new Set;return l.forEach(a=>{const s=new Date(a.date);s.getFullYear()===o&&e.add(s.getMonth())}),Array.from(e).sort((a,s)=>a-s)},[l,o]);r.useEffect(()=>{u.length>0&&!u.includes(i)&&p(u[0])},[u,i]),r.useEffect(()=>{d.length>0&&!d.includes(o)&&h(d[0])},[d,o]);const f=r.useMemo(()=>l.filter(e=>{const a=new Date(e.date);return a.getMonth()===i&&a.getFullYear()===o}),[l,i,o]),b=r.useMemo(()=>[{header:"Tanggal",cell:({row:e})=>H(new Date(e.original.date))},{header:"Shift",cell:({row:e})=>t.jsx("span",{className:`${e.original.shift_type==="Pagi"?"text-blue-500":"text-yellow-500"}`,children:e.original.shift_type})},{header:"Jam Masuk",cell:({row:e})=>e.original.clock_in??"-"},{header:"Jam Pulang",cell:({row:e})=>e.original.clock_out??"-"},{header:"Waktu Kerja",cell:({row:e})=>q(e.original.clock_in,e.original.clock_out,g)},{header:"Status",cell:({row:e})=>t.jsx(V,{status:e.original.status})}],[g]),x=N({data:f,columns:b,getCoreRowModel:y()});return t.jsxs(L,{breadcrumbs:[{title:"Rekap Presensi",href:"/"}],children:[t.jsx(I,{title:"Rekap Presensi"}),t.jsxs("div",{className:"overflow-x-auto p-4",children:[t.jsxs("div",{className:"mb-4 flex gap-4",children:[u.length>0&&t.jsxs(M,{value:i.toString(),onValueChange:e=>p(parseInt(e)),children:[t.jsx(T,{className:"sm:w-40",children:t.jsx(k,{placeholder:"Pilih Bulan"})}),t.jsx(R,{children:u.map(e=>t.jsx(v,{value:e.toString(),children:new Date(0,e).toLocaleDateString("id-ID",{month:"long"})},e))})]}),d.length>0&&t.jsxs(M,{value:o.toString(),onValueChange:e=>h(parseInt(e)),children:[t.jsx(T,{className:"sm:w-40",children:t.jsx(k,{placeholder:"Pilih Tahun"})}),t.jsx(R,{children:d.map(e=>t.jsx(v,{value:e.toString(),children:e},e))})]})]}),t.jsx("div",{className:"rounded-md border",children:t.jsxs(E,{children:[t.jsx(P,{children:x.getHeaderGroups().map(e=>t.jsx(w,{children:e.headers.map(a=>t.jsx(B,{children:D(a.column.columnDef.header,a.getContext())},a.id))},e.id))}),t.jsx(F,{children:x.getRowModel().rows.length>0?x.getRowModel().rows.map(e=>t.jsx(w,{children:e.getVisibleCells().map(a=>t.jsx(C,{children:D(a.column.columnDef.cell,a.getContext())},a.id))},e.id)):t.jsx(w,{children:t.jsx(C,{colSpan:100,className:"text-muted-foreground h-24 text-center",children:"Anda belum pernah melakukan presensi"})})})]})})]})]})}export{U as default};
